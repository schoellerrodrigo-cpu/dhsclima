import { useState, useEffect, useRef } from 'react'
import { MessageCircle, X, Send, Bot, User, Minimize2, Maximize2, Trash2, ThumbsUp, ThumbsDown, Copy, RotateCcw, Sparkles } from 'lucide-react'
import { useNavigate, useLocation } from 'react-router-dom'

interface Message {
  id: string
  text: string
  sender: 'user' | 'bot'
  timestamp: Date
  suggestions?: string[]
  feedback?: 'positive' | 'negative' | null
  copied?: boolean
}

interface KnowledgeBase {
  keywords: string[]
  response: string
  links?: { text: string; path: string }[]
  relatedQuestions?: string[]
  category?: string
  priority?: number
  synonyms?: string[] // Palavras alternativas que ajudam a identificar a pergunta
}

interface ChatHistory {
  messages: Message[]
  timestamp: Date
}

export default function ChatBot() {
  const [isOpen, setIsOpen] = useState(false)
  const [isMinimized, setIsMinimized] = useState(false)
  const [messages, setMessages] = useState<Message[]>([])
  const [inputValue, setInputValue] = useState('')
  const [isTyping, setIsTyping] = useState(false)
  const [showSuggestions, setShowSuggestions] = useState(true)
  const [conversationContext, setConversationContext] = useState<string[]>([])
  const [unreadCount, setUnreadCount] = useState(0)
  const messagesEndRef = useRef<HTMLDivElement>(null)
  const inputRef = useRef<HTMLInputElement>(null)
  const navigate = useNavigate()
  const location = useLocation()

  // Salvar e carregar histÃ³rico do localStorage
  useEffect(() => {
    const savedMessages = localStorage.getItem('dhs-chat-history')
    if (savedMessages) {
      try {
        const parsed = JSON.parse(savedMessages)
        if (parsed.length > 0 && Date.now() - new Date(parsed[0].timestamp).getTime() < 24 * 60 * 60 * 1000) {
          // Carregar apenas se for menos de 24h
          setMessages(parsed.map((m: any) => ({
            ...m,
            timestamp: new Date(m.timestamp)
          })))
    {
      keywords: ['o que Ã© dhs', 'dhs', 'desenvolvimento harmÃ´nico', 'conceito dhs', 'definiÃ§Ã£o dhs', 'explique dhs', 'significa dhs'],
      response: 'O **Desenvolvimento HarmÃ´nico e SustentÃ¡vel (DHS)** Ã© um novo paradigma que busca o equilÃ­brio entre trÃªs eixos fundamentais:\n\nðŸŒ± **Social** - bem-estar e inclusÃ£o de todos\nðŸ’° **EconÃ´mico** - prosperidade compartilhada e justa\nðŸŒ **Ambiental** - preservaÃ§Ã£o e sustentabilidade\n\nDiferente do modelo atual que prioriza apenas o crescimento econÃ´mico (PIB), o DHS promove uma visÃ£o **sistÃªmica e integrada** do desenvolvimento.\n\nâœ¨ **PrincÃ­pios centrais:**\nâ€¢ Pensamento sistÃªmico\nâ€¢ EquilÃ­brio entre os trÃªs eixos\nâ€¢ ConvergÃªncia estrutural\nâ€¢ AtuaÃ§Ã£o resolutiva\nâ€¢ Sustentabilidade de longo prazo',
      category: 'conceitos',
      priority: 10,
      links: [
        { text: 'Ver mais sobre SoluÃ§Ãµes', path: '/solucoes' },
        { text: 'Entender o DiagnÃ³stico', path: '/diagnostico' }
      ],
      relatedQuestions: ['Como implementar o DHS?', 'Quais sÃ£o as metodologias?', 'O que Ã© convergÃªncia estrutural?']
    }, (messages.length > 0) {
      localStorage.setItem('dhs-chat-history', JSON.stringify(messages))
    }
  }, [messages])

  // Detectar mudanÃ§a de pÃ¡gina e oferecer ajuda contextual
  useEffect(() => {
    if (isOpen) return
    
    const pathMap: { [key: string]: string } = {
      '/': 'Precisa de ajuda para navegar no DHS Guide?',
      '/diagnostico': 'Quer entender melhor o diagnÃ³stico da crise atual?',
      '/solucoes': 'Tem dÃºvidas sobre as soluÃ§Ãµes DHS?',
      '/metodologias': 'Posso explicar as metodologias em detalhes!',
      '/implementacao': 'Precisa de ajuda com a implementaÃ§Ã£o?',
      '/plano-contingencia': 'Tem dÃºvidas sobre Planos de ContingÃªncia?',
      '/primeira-infancia': 'Quer saber mais sobre EducaÃ§Ã£o Infantil?',
      '/violencia-eca': 'Posso explicar sobre proteÃ§Ã£o de crianÃ§as e ECA',
      '/organizacoes-criminosas': 'Tem perguntas sobre combate ao crime organizado?',
      '/cao-estrada': 'Precisa de informaÃ§Ãµes sobre seguranÃ§a em rodovias?',
      '/calculadora': 'Precisa de ajuda com a Calculadora DHS?'
    }

    if (pathMap[location.pathname] && messages.length === 0) {
      setTimeout(() => {
        setUnreadCount(1)
      }, 3000)
    }
  }, [location.pathname])

  // Focar input quando abrir
  useEffect(() => {
    if (isOpen && !isMinimized) {
      inputRef.current?.focus()
      setUnreadCount(0)
    }
  }, [isOpen, isMinimized])

  // Base de conhecimento completa e expandida do site
  const knowledgeBase: KnowledgeBase[] = [
    {
      keywords: ['olÃ¡', 'oi', 'ola', 'bom dia', 'boa tarde', 'boa noite', 'hey', 'hello', 'opa', 'e aÃ­', 'eai'],
      response: 'OlÃ¡! Bem-vindo ao DHS Guide! ðŸ‘‹\n\nSou seu assistente virtual e estou aqui para ajudÃ¡-lo a entender o Desenvolvimento HarmÃ´nico e SustentÃ¡vel.\n\nPosso responder perguntas sobre:',
      category: 'saudaÃ§Ã£o',
      priority: 10,
      suggestions: [
        'O que Ã© DHS?',
        'Como implementar?',
        'Plano de ContingÃªncia',
        'Primeira InfÃ¢ncia'
      ]
    },
    {
      keywords: ['o que Ã© dhs', 'dhs', 'desenvolvimento harmÃ´nico', 'conceito dhs', 'definiÃ§Ã£o dhs'],
      response: 'O **Desenvolvimento HarmÃ´nico e SustentÃ¡vel (DHS)** Ã© um novo paradigma que busca o equilÃ­brio entre trÃªs eixos fundamentais:\n\nðŸŒ± **Social** - bem-estar e inclusÃ£o\nðŸ’° **EconÃ´mico** - prosperidade compartilhada\nðŸŒ **Ambiental** - preservaÃ§Ã£o e sustentabilidade\n\nDiferente do modelo atual que prioriza apenas o crescimento econÃ´mico, o DHS promove uma visÃ£o sistÃªmica e integrada do desenvolvimento.',
      links: [
        { text: 'Ver mais sobre SoluÃ§Ãµes', path: '/solucoes' },
        { text: 'Entender o DiagnÃ³stico', path: '/diagnostico' }
      ],
    {
      keywords: ['convergÃªncia estrutural', 'convergencia', 'alinhamento', 'integraÃ§Ã£o setores', 'convergir', 'articulaÃ§Ã£o'],
      response: '**ConvergÃªncia Estrutural** Ã© o mecanismo pelo qual diferentes setores (pÃºblico, privado e sociedade civil) alinham suas aÃ§Ãµes para objetivos comuns.\n\nðŸ“‹ **Envolve 5 dimensÃµes:**\n1ï¸âƒ£ **Planejamento** - metas integradas\n2ï¸âƒ£ **OrÃ§amento** - recursos alinhados\n3ï¸âƒ£ **Indicadores** - mÃ©tricas compartilhadas\n4ï¸âƒ£ **FiscalizaÃ§Ã£o** - controle coordenado\n5ï¸âƒ£ **Incentivos** - estÃ­mulos compatÃ­veis\n\nðŸŽ¯ Ã‰ a ponte entre o planejamento sistÃªmico e o desenvolvimento sustentÃ¡vel real.\n\nðŸ’¡ Exemplo prÃ¡tico: Diferentes Ã³rgÃ£os trabalhando juntos para expandir vagas em creches (EducaÃ§Ã£o + SaÃºde + AssistÃªncia + MinistÃ©rio PÃºblico + sociedade civil).',
      category: 'conceitos',
      priority: 9,
      links: [
        { text: 'Ver Matriz de ConvergÃªncia', path: '/implementacao' },
        { text: 'Conhecer as Metodologias', path: '/metodologias' }
      ],
      relatedQuestions: ['Como promover convergÃªncia?', 'O que Ã© a Matriz de ConvergÃªncia?']
    },  { text: 'Conhecer as Metodologias', path: '/metodologias' }
      ]
    },
    {
      keywords: ['plancon', 'plano contingÃªncia', 'plano de contingÃªncia', 'defesa civil', 'desastres', 'emergÃªncias', 'comdec'],
      response: '**Plano de ContingÃªncia (PLANCON)** Ã© um instrumento obrigatÃ³rio para municÃ­pios enfrentarem desastres naturais.\n\nðŸ›¡ï¸ **Elementos principais:**\nâ€¢ Mapeamento de Ã¡reas de risco\nâ€¢ Sistema de monitoramento e alerta\nâ€¢ Rotas de evacuaÃ§Ã£o\nâ€¢ Abrigos temporÃ¡rios\nâ€¢ Equipes de resposta (COMDEC)\nâ€¢ NUPDECs (NÃºcleos ComunitÃ¡rios)\n\nâš ï¸ **ImportÃ¢ncia:** A Lei 12.608/2012 exige que municÃ­pios em Ã¡rea de risco tenham PLANCON atualizado.',
      category: 'plancon',
      priority: 9,
      links: [
        { text: 'Ver Guia Completo PLANCON', path: '/plano-contingencia' }
      ],
      relatedQuestions: ['Quais sÃ£o os passos para fazer um PLANCON?', 'O que sÃ£o NUPDECs?', 'Como mapear Ã¡reas de risco?']
    },
    {
      keywords: ['passos plancon', 'passos plano contingÃªncia', 'como fazer plancon', 'elaborar plancon', 'etapas plancon', 'criar plano contingÃªncia', 'fazer plano contingencia', 'passos para fazer plancon', 'passos para fazer plano', 'etapas para fazer plancon'],
      synonyms: ['quais passos', 'quais etapas', 'qual passo a passo', 'como elaborar', 'como criar', 'como desenvolver', 'procedimento', 'metodologia', 'roteiro'],
      response: '**Passos para Elaborar um Plano de ContingÃªncia (PLANCON):**\n\nðŸ“‹ **1. DIAGNÃ“STICO**\n   â€¢ Identificar Ã¡reas de risco (enchentes, deslizamentos)\n   â€¢ Mapear populaÃ§Ã£o vulnerÃ¡vel\n   â€¢ Levantar infraestrutura crÃ­tica\n   â€¢ Analisar histÃ³rico de desastres\n\nðŸ—ºï¸ **2. MAPEAMENTO**\n   â€¢ Cartografia de riscos\n   â€¢ Rotas de fuga e evacuaÃ§Ã£o\n   â€¢ LocalizaÃ§Ã£o de abrigos\n   â€¢ Pontos de encontro\n\nðŸ‘¥ **3. ESTRUTURAÃ‡ÃƒO**\n   â€¢ Criar/fortalecer COMDEC\n   â€¢ Formar NUPDECs comunitÃ¡rios\n   â€¢ Definir responsabilidades\n   â€¢ Estabelecer hierarquia de comando\n\nðŸ“¡ **4. SISTEMA DE ALERTA**\n   â€¢ Monitoramento meteorolÃ³gico\n   â€¢ Protocolos de acionamento\n   â€¢ Canais de comunicaÃ§Ã£o\n   â€¢ Sirenes e avisos\n\nðŸƒ **5. PROCEDIMENTOS**\n   â€¢ Protocolos de evacuaÃ§Ã£o\n   â€¢ GestÃ£o de abrigos\n   â€¢ DistribuiÃ§Ã£o de recursos\n   â€¢ AssistÃªncia emergencial\n\nðŸŽ“ **6. CAPACITAÃ‡ÃƒO**\n   â€¢ Treinamento de equipes\n   â€¢ ExercÃ­cios simulados\n   â€¢ EducaÃ§Ã£o da populaÃ§Ã£o\n\nðŸ“Š **7. DOCUMENTAÃ‡ÃƒO**\n   â€¢ Registrar tudo em documento formal\n   â€¢ AprovaÃ§Ã£o pelo COMDEC\n   â€¢ DivulgaÃ§Ã£o ampla\n\nðŸ”„ **8. ATUALIZAÃ‡ÃƒO**\n   â€¢ RevisÃ£o periÃ³dica\n   â€¢ Ajustes pÃ³s-eventos\n   â€¢ Melhoria contÃ­nua',
      category: 'plancon',
      priority: 10,
      links: [
        { text: 'Ver Guia Detalhado', path: '/plano-contingencia' },
        { text: 'Usar Matriz de ConvergÃªncia', path: '/implementacao' }
      ],
      relatedQuestions: ['Como mapear Ã¡reas de risco?', 'O que Ã© COMDEC?', 'Como treinar equipes?']
    },
    {
      keywords: ['mapear risco', 'mapeamento risco', 'identificar risco', 'Ã¡reas vulnerÃ¡veis', 'cartografia risco', 'como mapear risco', 'mapear Ã¡reas risco'],
      response: '**Como Mapear Ãreas de Risco:**\n\nðŸ—ºï¸ **1. LEVANTAMENTO GEOGRÃFICO**\n   â€¢ Topografia do municÃ­pio\n   â€¢ Bacias hidrogrÃ¡ficas\n   â€¢ Encostas e morros\n   â€¢ Ãreas de preservaÃ§Ã£o\n\nðŸ“Š **2. ANÃLISE HISTÃ“RICA**\n   â€¢ Desastres anteriores\n   â€¢ Pontos crÃ­ticos recorrentes\n   â€¢ Danos registrados\n   â€¢ PadrÃµes sazonais\n\nðŸ˜ï¸ **3. VISTORIAS IN LOCO**\n   â€¢ Defesa Civil + tÃ©cnicos\n   â€¢ Registros fotogrÃ¡ficos\n   â€¢ Entrevistas com moradores\n   â€¢ IdentificaÃ§Ã£o de vulnerabilidades\n\nðŸ“ˆ **4. CLASSIFICAÃ‡ÃƒO DE RISCO**\n   â€¢ Muito alto (R4)\n   â€¢ Alto (R3)\n   â€¢ MÃ©dio (R2)\n   â€¢ Baixo (R1)\n\nðŸŽ¨ **5. PRODUÃ‡ÃƒO CARTOGRÃFICA**\n   â€¢ Mapas temÃ¡ticos por tipo de risco\n   â€¢ SobreposiÃ§Ã£o de camadas\n   â€¢ Georreferenciamento\n   â€¢ Sistema de cores\n\nðŸ‘¥ **6. PARTICIPAÃ‡ÃƒO COMUNITÃRIA**\n   â€¢ NUPDECs identificam locais\n   â€¢ Conhecimento local\n   â€¢ ValidaÃ§Ã£o dos mapas',
      category: 'plancon',
      priority: 8,
      links: [
        { text: 'Ver mais sobre PLANCON', path: '/plano-contingencia' }
      ],
      relatedQuestions: ['O que sÃ£o NUPDECs?', 'Como criar COMDEC?']
    },
    {
      keywords: ['nupdec', 'nudec', 'nÃºcleos comunitÃ¡rios', 'defesa civil comunitÃ¡ria', 'voluntÃ¡rios'],
      response: '**NUPDECs** (NÃºcleos ComunitÃ¡rios de ProteÃ§Ã£o e Defesa Civil) sÃ£o grupos de voluntÃ¡rios da prÃ³pria comunidade.\n\nðŸ‘¥ **FunÃ§Ã£o:**\nâ€¢ Elo entre populaÃ§Ã£o e Defesa Civil\nâ€¢ Mapeamento participativo de riscos\nâ€¢ Monitoramento local de perigos\nâ€¢ EducaÃ§Ã£o preventiva\nâ€¢ Resposta imediata em emergÃªncias\n\nðŸŒ A OIM/ONU apoia os NUPDECs como ferramenta de gestÃ£o de migraÃ§Ã£o ambiental.',
      category: 'plancon',
      priority: 8,
      links: [
        { text: 'Saber mais sobre NUPDECs', path: '/plano-contingencia' }
      ],
      relatedQuestions: ['Como criar um NUPDEC?', 'Quem pode participar?']
    },
    {
      keywords: ['criar nupdec', 'formar nupdec', 'organizar nupdec', 'montar nÃºcleo comunitÃ¡rio', 'como criar nupdec'],
      response: '**Como Criar um NUPDEC:**\n\n1ï¸âƒ£ **MOBILIZAÃ‡ÃƒO**\n   â€¢ Identificar lideranÃ§as locais\n   â€¢ Reunir moradores interessados\n   â€¢ Apresentar proposta Ã  comunidade\n\n2ï¸âƒ£ **FORMALIZAÃ‡ÃƒO**\n   â€¢ Registrar junto Ã  Defesa Civil\n   â€¢ Definir coordenaÃ§Ã£o\n   â€¢ Estabelecer Ã¡rea de atuaÃ§Ã£o\n\n3ï¸âƒ£ **CAPACITAÃ‡ÃƒO**\n   â€¢ Treinamento pela Defesa Civil\n   â€¢ Primeiros socorros\n   â€¢ IdentificaÃ§Ã£o de riscos\n   â€¢ Protocolos de emergÃªncia\n\n4ï¸âƒ£ **MAPEAMENTO**\n   â€¢ Identificar Ã¡reas vulnerÃ¡veis\n   â€¢ Cadastrar famÃ­lias em risco\n   â€¢ Documentar pontos crÃ­ticos\n\n5ï¸âƒ£ **PLANEJAMENTO**\n   â€¢ Rotas de fuga\n   â€¢ Pontos de encontro\n   â€¢ Sistema de comunicaÃ§Ã£o\n\n6ï¸âƒ£ **ATUAÃ‡ÃƒO**\n   â€¢ Monitoramento preventivo\n   â€¢ EducaÃ§Ã£o comunitÃ¡ria\n   â€¢ Resposta a emergÃªncias',
      category: 'plancon',
      priority: 7,
      links: [
        { text: 'Ver pÃ¡gina PLANCON', path: '/plano-contingencia' }
      ]
    },priority: 10,
      links: [
        { text: 'Ver Guia Detalhado', path: '/plano-contingencia' },
        { text: 'Usar Matriz de ConvergÃªncia', path: '/implementacao' }
      ],
      relatedQuestions: ['Como mapear Ã¡reas de risco?', 'O que Ã© COMDEC?', 'Como treinar equipes?']
    },
    {
      keywords: ['mapear risco', 'mapeamento risco', 'identificar risco', 'Ã¡reas vulnerÃ¡veis', 'cartografia risco'],
      response: '**Como Mapear Ãreas de Risco:**\n\nðŸ—ºï¸ **1. LEVANTAMENTO GEOGRÃFICO**\n   â€¢ Topografia do municÃ­pio\n   â€¢ Bacias hidrogrÃ¡ficas\n   â€¢ Encostas e morros\n   â€¢ Ãreas de preservaÃ§Ã£o\n\nðŸ“Š **2. ANÃLISE HISTÃ“RICA**\n   â€¢ Desastres anteriores\n   â€¢ Pontos crÃ­ticos recorrentes\n   â€¢ Danos registrados\n   â€¢ PadrÃµes sazonais\n\nðŸ˜ï¸ **3. VISTORIAS IN LOCO**\n   â€¢ Defesa Civil + tÃ©cnicos\n   â€¢ Registros fotogrÃ¡ficos\n   â€¢ Entrevistas com moradores\n   â€¢ IdentificaÃ§Ã£o de vulnerabilidades\n\nðŸ“ˆ **4. CLASSIFICAÃ‡ÃƒO DE RISCO**\n   â€¢ Muito alto (R4)\n   â€¢ Alto (R3)\n   â€¢ MÃ©dio (R2)\n   â€¢ Baixo (R1)\n\nðŸŽ¨ **5. PRODUÃ‡ÃƒO CARTOGRÃFICA**\n   â€¢ Mapas temÃ¡ticos por tipo de risco\n   â€¢ SobreposiÃ§Ã£o de camadas\n   â€¢ Georreferenciamento\n   â€¢ Sistema de cores\n\nðŸ‘¥ **6. PARTICIPAÃ‡ÃƒO COMUNITÃRIA**\n   â€¢ NUPDECs identificam locais\n   â€¢ Conhecimento local\n   â€¢ ValidaÃ§Ã£o dos mapas',
      category: 'plancon',
    {
      keywords: ['primeira infÃ¢ncia', 'educaÃ§Ã£o infantil', 'creche', 'prÃ©-escola', 'fundeb', 'vagas'],
      response: '**Primeira InfÃ¢ncia e EducaÃ§Ã£o Infantil** (0 a 6 anos) sÃ£o prioridades absolutas no Brasil.\n\nðŸŽ¯ **Principais questÃµes:**\nâ€¢ DÃ©ficit de vagas em creches\nâ€¢ Filas de espera\nâ€¢ Qualidade do atendimento (DONQEEI)\nâ€¢ Financiamento (FUNDEB)\nâ€¢ Marco Legal da Primeira InfÃ¢ncia\n\nðŸ“Š **Dados:** Cerca de 632 mil crianÃ§as aguardam vaga em creche no Brasil.',
      category: 'educaÃ§Ã£o',
      priority: 9,
      links: [
        { text: 'Ver pÃ¡gina completa', path: '/primeira-infancia' }
      ],
      relatedQuestions: ['Como expandir vagas?', 'O que Ã© DONQEEI?', 'Passos para ampliar educaÃ§Ã£o infantil?']
    },
    {
      keywords: ['expandir vagas', 'ampliar creche', 'aumentar vagas', 'como expandir educaÃ§Ã£o infantil', 'passos expandir vagas'],
      response: '**Passos para Expandir Vagas em EducaÃ§Ã£o Infantil:**\n\nðŸ“Š **1. DIAGNÃ“STICO**\n   â€¢ Levantar demanda real\n   â€¢ Mapear fila de espera\n   â€¢ Identificar bairros crÃ­ticos\n   â€¢ Analisar capacidade atual\n\nðŸ’° **2. PLANEJAMENTO ORÃ‡AMENTÃRIO**\n   â€¢ Calcular custo por vaga\n   â€¢ Identificar fontes (FUNDEB, convÃªnios)\n   â€¢ Projetar investimento necessÃ¡rio\n   â€¢ Planejar manutenÃ§Ã£o\n\nðŸ—ï¸ **3. INFRAESTRUTURA**\n   â€¢ Construir novas unidades\n   â€¢ Adaptar espaÃ§os existentes\n   â€¢ Garantir acessibilidade\n   â€¢ Seguir DONQEEI\n\nðŸ‘¨â€ðŸ« **4. RECURSOS HUMANOS**\n   â€¢ Realizar concursos\n   â€¢ Capacitar profissionais\n   â€¢ Respeitar razÃ£o crianÃ§a/educador\n   â€¢ Plano de carreira\n\nâš–ï¸ **5. CONVERGÃŠNCIA ESTRUTURAL**\n   â€¢ Articular EducaÃ§Ã£o + SaÃºde + AssistÃªncia\n   â€¢ Envolver MinistÃ©rio PÃºblico\n   â€¢ Mobilizar sociedade civil\n   â€¢ Buscar parcerias\n\nðŸ“‹ **6. GESTÃƒO DE FILA**\n   â€¢ CritÃ©rios transparentes\n   â€¢ Sistema informatizado\n   â€¢ PriorizaÃ§Ã£o legal (vulnerabilidade)\n   â€¢ AtualizaÃ§Ã£o constante\n\nðŸ“ˆ **7. MONITORAMENTO**\n   â€¢ Indicadores de acesso\n   â€¢ Qualidade do atendimento\n   â€¢ SatisfaÃ§Ã£o das famÃ­lias\n   â€¢ Ajustes contÃ­nuos',
      category: 'educaÃ§Ã£o',
      priority: 10,
      links: [
        { text: 'Ver Guia Completo', path: '/primeira-infancia' },
        { text: 'Usar Matriz de ConvergÃªncia', path: '/implementacao' }
      ],
      relatedQuestions: ['O que Ã© FUNDEB?', 'Quanto custa uma vaga?', 'O que Ã© DONQEEI?']
    {
      keywords: ['donqeei', 'qualidade educaÃ§Ã£o infantil', 'parÃ¢metros', 'razÃ£o crianÃ§a educador'],
      response: '**DONQEEI** = Documentos Orientadores de Normas e Qualidade da EducaÃ§Ã£o Infantil\n\nðŸ“ **Estabelece padrÃµes como:**\nâ€¢ RazÃ£o crianÃ§a/educador por idade\nâ€¢ Infraestrutura adequada\nâ€¢ FormaÃ§Ã£o de professores\nâ€¢ AlimentaÃ§Ã£o e nutriÃ§Ã£o\nâ€¢ CurrÃ­culo e pedagogia\n\nðŸ‘¶ **Exemplos de razÃ£o crianÃ§a/educador:**\nâ€¢ 0-12 meses: 5 bebÃªs por educador\nâ€¢ 1-2 anos: 8 crianÃ§as por educador\nâ€¢ 2-3 anos: 12 crianÃ§as por educador\nâ€¢ 3-4 anos: 15 crianÃ§as por educador',
      category: 'educaÃ§Ã£o',
      priority: 7,
      links: [
        { text: 'Ver parÃ¢metros completos', path: '/primeira-infancia' }
      ]
    },
    {
      keywords: ['fundeb', 'financiamento educaÃ§Ã£o', 'recursos educaÃ§Ã£o', 'orÃ§amento educaÃ§Ã£o'],
      response: '**FUNDEB** = Fundo de ManutenÃ§Ã£o e Desenvolvimento da EducaÃ§Ã£o BÃ¡sica\n\nðŸ’° **CaracterÃ­sticas:**\nâ€¢ Principal fonte de financiamento da educaÃ§Ã£o\nâ€¢ DistribuiÃ§Ã£o por nÂº de matrÃ­culas\nâ€¢ EducaÃ§Ã£o infantil tem valor diferenciado\nâ€¢ ComplementaÃ§Ã£o da UniÃ£o\nâ€¢ Controle social obrigatÃ³rio\n\nðŸ“Š **AplicaÃ§Ã£o:**\nâ€¢ MÃ­nimo 60% em remuneraÃ§Ã£o de profissionais\nâ€¢ 40% em outras despesas educacionais\nâ€¢ Vedado desvio de finalidade\n\nâœ… Ferramenta essencial para expandir vagas em creches e prÃ©-escolas.',
      category: 'educaÃ§Ã£o',
      priority: 7,
      links: [
        { text: 'Ver mais sobre Primeira InfÃ¢ncia', path: '/primeira-infancia' }
      ]
    },keywords: ['primeira infÃ¢ncia', 'educaÃ§Ã£o infantil', 'creche', 'prÃ©-escola', 'fundeb', 'vagas'],
      response: '**Primeira InfÃ¢ncia e EducaÃ§Ã£o Infantil** (0 a 6 anos) sÃ£o prioridades absolutas no Brasil.\n\nðŸŽ¯ **Principais questÃµes:**\nâ€¢ DÃ©ficit de vagas em creches\nâ€¢ Filas de espera\nâ€¢ Qualidade do atendimento (DONQEEI)\nâ€¢ Financiamento (FUNDEB)\nâ€¢ Marco Legal da Primeira InfÃ¢ncia\n\nðŸ“Š **Dados:** Cerca de 632 mil crianÃ§as aguardam vaga em creche no Brasil.',
      links: [
    {
      keywords: ['violÃªncia', 'eca', 'estatuto crianÃ§a', 'abuso', 'negligÃªncia', 'conselho tutelar'],
      response: '**ViolÃªncia contra CrianÃ§as e Adolescentes** Ã© uma grave violaÃ§Ã£o de direitos.\n\nâš ï¸ **Tipos de violÃªncia:**\nâ€¢ FÃ­sica e psicolÃ³gica\nâ€¢ Sexual e exploraÃ§Ã£o\nâ€¢ NegligÃªncia e abandono\nâ€¢ Trabalho infantil\nâ€¢ Bullying e cyberbullying\n\nðŸ“ž **Denuncie:** Disque 100 ou Conselho Tutelar\n\nðŸ›¡ï¸ O ECA garante proteÃ§Ã£o integral e absoluta prioridade.',
      category: 'proteÃ§Ã£o',
      priority: 9,
      links: [
        { text: 'Conhecer o ECA', path: '/violencia-eca' }
    {
      keywords: ['crime organizado', 'facÃ§Ãµes', 'pcc', 'trÃ¡fico', 'lavagem dinheiro', 'seguranÃ§a'],
      response: '**Combate a OrganizaÃ§Ãµes Criminosas** exige atuaÃ§Ã£o estrutural e sistÃªmica.\n\nðŸŽ¯ **Principais frentes:**\nâ€¢ InvestigaÃ§Ã£o e inteligÃªncia\nâ€¢ RepressÃ£o qualificada (GAECO, DRACO)\nâ€¢ PrevenÃ§Ã£o e polÃ­ticas pÃºblicas\nâ€¢ Lavagem de dinheiro\nâ€¢ Sistema prisional\n\nâš–ï¸ LegislaÃ§Ã£o: Leis 12.850/2013 e 12.694/2012',
      category: 'seguranÃ§a',
      priority: 8,
      links: [
        { text: 'Saber mais', path: '/organizacoes-criminosas' }
      ],
      relatedQuestions: ['Como combater o crime organizado?', 'O que Ã© GAECO?']
    },
    {
      keywords: ['combater crime', 'enfrentar crime organizado', 'estratÃ©gias crime', 'aÃ§Ãµes crime organizado'],
      response: '**EstratÃ©gias para Combater Crime Organizado:**\n\nðŸ” **1. INTELIGÃŠNCIA**\n   â€¢ InvestigaÃ§Ã£o profunda\n   â€¢ InterceptaÃ§Ã£o telefÃ´nica\n   â€¢ InfiltraÃ§Ã£o de agentes\n   â€¢ ColaboraÃ§Ã£o premiada\n\nðŸ’° **2. SEGUIR O DINHEIRO**\n   â€¢ Rastreamento financeiro\n   â€¢ Bloqueio de bens\n   â€¢ Combate Ã  lavagem\n   â€¢ RecuperaÃ§Ã£o de ativos\n\nâš–ï¸ **3. ATUAÃ‡ÃƒO JURÃDICA**\n   â€¢ GAECO (Grupo de Combate)\n   â€¢ DenÃºncias robustas\n   â€¢ Medidas cautelares\n   â€¢ CondenaÃ§Ãµes exemplares\n\nðŸ›¡ï¸ **4. PREVENÃ‡ÃƒO**\n   â€¢ PolÃ­ticas sociais\n   â€¢ EducaÃ§Ã£o e oportunidades\n   â€¢ Fortalecimento comunitÃ¡rio\n   â€¢ ReduÃ§Ã£o de vulnerabilidades\n\nðŸ¤ **5. CONVERGÃŠNCIA INSTITUCIONAL**\n   â€¢ PolÃ­cia + MP + JudiciÃ¡rio\n   â€¢ IntegraÃ§Ã£o de dados\n   â€¢ Protocolos unificados\n   â€¢ CooperaÃ§Ã£o internacional\n\nðŸ”’ **6. SISTEMA PRISIONAL**\n   â€¢ Isolamento de lideranÃ§as\n   â€¢ Impedir comando de dentro\n   â€¢ RessocializaÃ§Ã£o efetiva',
      category: 'seguranÃ§a',
      priority: 8,
      links: [
        { text: 'Ver pÃ¡gina completa', path: '/organizacoes-criminosas' }
      ]
    },category: 'proteÃ§Ã£o',
      priority: 8,
      links: [
        { text: 'Ver mais sobre ECA', path: '/violencia-eca' }
      ]
    },response: '**DONQEEI** = Documentos Orientadores de Normas e Qualidade da EducaÃ§Ã£o Infantil\n\nðŸ“ **Estabelece padrÃµes como:**\nâ€¢ RazÃ£o crianÃ§a/educador por idade\nâ€¢ Infraestrutura adequada\nâ€¢ FormaÃ§Ã£o de professores\nâ€¢ AlimentaÃ§Ã£o e nutriÃ§Ã£o\nâ€¢ CurrÃ­culo e pedagogia\n\nExemplo: Para bebÃªs 0-12 meses = 5 bebÃªs por educador(a)',
      links: [
        { text: 'Ver parÃ¢metros completos', path: '/primeira-infancia' }
      ]
    },
    {
      keywords: ['violÃªncia', 'eca', 'estatuto crianÃ§a', 'abuso', 'negligÃªncia', 'conselho tutelar'],
      response: '**ViolÃªncia contra CrianÃ§as e Adolescentes** Ã© uma grave violaÃ§Ã£o de direitos.\n\nâš ï¸ **Tipos de violÃªncia:**\nâ€¢ FÃ­sica e psicolÃ³gica\nâ€¢ Sexual e exploraÃ§Ã£o\nâ€¢ NegligÃªncia e abandono\nâ€¢ Trabalho infantil\nâ€¢ Bullying e cyberbullying\n\nðŸ“ž **Denuncie:** Disque 100 ou Conselho Tutelar\n\nðŸ›¡ï¸ O ECA garante proteÃ§Ã£o integral e absoluta prioridade.',
      links: [
        { text: 'Conhecer o ECA', path: '/violencia-eca' }
      ]
    },
    {
      keywords: ['calculadora', 'avaliar', 'medir impacto', 'anÃ¡lise', 'usar calculadora', 'como usar calculadora'],
      response: '**Calculadora DHS** permite avaliar projetos e polÃ­ticas nos trÃªs eixos:\n\nðŸ“Š **Avalia impactos em:**\nâ€¢ Eixo Social\nâ€¢ Eixo EconÃ´mico  \nâ€¢ Eixo Ambiental\n\nðŸŽ¯ **Como usar:**\n1. Acesse a Calculadora\n2. Insira dados do projeto/polÃ­tica\n3. Avalie impacto em cada eixo (0-10)\n4. Veja resultado visual\n5. Identifique desequilÃ­brios\n6. Ajuste para maior harmonia\n\nâœ… Resultado ideal: equilÃ­brio entre os trÃªs eixos.',
      category: 'ferramentas',
      priority: 7,
      links: [
        { text: 'Usar Calculadora', path: '/calculadora' }
      ]
    },
    {
      keywords: ['acidentes', 'trÃ¢nsito', 'rodovia', 'cÃ£o estrada', 'animais soltos', 'br'],
      response: '**CÃ£o na Estrada** - PrevenÃ§Ã£o de acidentes com animais em rodovias\n\nðŸš— **Problema:**\nâ€¢ Animais soltos causam acidentes graves\nâ€¢ Mortes e feridos\nâ€¢ Responsabilidade de concessionÃ¡rias\n\nâœ… **SoluÃ§Ãµes:**\nâ€¢ Cercas e telas de proteÃ§Ã£o\nâ€¢ FiscalizaÃ§Ã£o e recolhimento\nâ€¢ Posse responsÃ¡vel\nâ€¢ AtuaÃ§Ã£o do MP',
      links: [
        { text: 'Ver detalhes', path: '/cao-estrada' }
      ]
    },
    {
    {
      keywords: ['como implementar', 'implementaÃ§Ã£o', 'passo a passo', 'comeÃ§ar', 'aplicar', 'implementar dhs'],
      response: '**Como Implementar o DHS - Passo a Passo:**\n\n1ï¸âƒ£ **Escolher Foco PrioritÃ¡rio**\n   â€¢ ConveniÃªncia, oportunidade, urgÃªncia\n\n2ï¸âƒ£ **Mapear Necessidades e Possibilidades**\n   â€¢ DiagnÃ³stico situacional\n\n3ï¸âƒ£ **Promover ConvergÃªncia Estrutural**\n   â€¢ 13 atividades ordenadas\n   â€¢ Matriz de ConvergÃªncia\n\nExistem casos prÃ¡ticos em educaÃ§Ã£o infantil, PLANCONs e outras Ã¡reas.',
      category: 'implementaÃ§Ã£o',
      priority: 10,
      links: [
        { text: 'Ver Guia Completo', path: '/implementacao' }
      ],
      relatedQuestions: ['Quais sÃ£o as 13 atividades?', 'O que Ã© a Matriz de ConvergÃªncia?', 'Casos prÃ¡ticos de implementaÃ§Ã£o?']
    },
    {
      keywords: ['13 atividades', 'treze atividades', 'atividades convergÃªncia', 'etapas implementaÃ§Ã£o'],
      response: '**13 Atividades para ConvergÃªncia Estrutural:**\n\n1ï¸âƒ£ Definir objetivo comum\n2ï¸âƒ£ Mapear atores e recursos\n3ï¸âƒ£ Diagnosticar situaÃ§Ã£o atual\n4ï¸âƒ£ Estabelecer metas compartilhadas\n5ï¸âƒ£ Alinhar planejamentos setoriais\n6ï¸âƒ£ Integrar orÃ§amentos\n7ï¸âƒ£ Definir indicadores comuns\n8ï¸âƒ£ Estabelecer governanÃ§a\n9ï¸âƒ£ Criar canais de comunicaÃ§Ã£o\nðŸ”Ÿ Implementar aÃ§Ãµes coordenadas\n1ï¸âƒ£1ï¸âƒ£ Monitorar progresso conjunto\n1ï¸âƒ£2ï¸âƒ£ Avaliar resultados integrados\n1ï¸âƒ£3ï¸âƒ£ Ajustar e aprimorar continuamente\n\nâœ… Cada atividade possui passos detalhados na Matriz de ConvergÃªncia.',
      category: 'implementaÃ§Ã£o',
      priority: 9,
      links: [
        { text: 'Ver Matriz Detalhada', path: '/implementacao' }
      ]
    },
    {
      keywords: ['casos prÃ¡ticos', 'exemplos', 'aplicaÃ§Ã£o prÃ¡tica', 'casos reais', 'exemplos dhs'],
      response: '**Casos PrÃ¡ticos de ImplementaÃ§Ã£o DHS:**\n\nðŸŽ“ **EDUCAÃ‡ÃƒO INFANTIL**\n   â€¢ ExpansÃ£o de vagas em creches\n   â€¢ ConvergÃªncia: EducaÃ§Ã£o + SaÃºde + AssistÃªncia + MP\n   â€¢ Resultado: ReduÃ§Ã£o de fila e qualidade\n\nðŸ›¡ï¸ **PLANOS DE CONTINGÃŠNCIA**\n   â€¢ ProteÃ§Ã£o contra desastres naturais\n   â€¢ ConvergÃªncia: Defesa Civil + SaÃºde + HabitaÃ§Ã£o + Comunidade\n   â€¢ Resultado: Comunidades resilientes\n\nðŸš¸ **PROTEÃ‡ÃƒO Ã€ INFÃ‚NCIA**\n   â€¢ Combate Ã  violÃªncia contra crianÃ§as\n   â€¢ ConvergÃªncia: EducaÃ§Ã£o + SaÃºde + JustiÃ§a + AssistÃªncia\n   â€¢ Resultado: Rede de proteÃ§Ã£o efetiva\n\nðŸŒ **MEIO AMBIENTE**\n   â€¢ GestÃ£o sustentÃ¡vel de recursos\n   â€¢ ConvergÃªncia: Ambiente + Economia + Comunidades\n   â€¢ Resultado: Desenvolvimento sustentÃ¡vel\n\nTodos seguem a mesma metodologia de convergÃªncia estrutural.',
      category: 'implementaÃ§Ã£o',
      priority: 8,
      links: [
        { text: 'Ver ImplementaÃ§Ã£o', path: '/implementacao' },
        { text: 'PLANCON', path: '/plano-contingencia' },
        { text: 'Primeira InfÃ¢ncia', path: '/primeira-infancia' }
      ]
    },
      keywords: ['cnmp', 'recomendaÃ§Ã£o 54', '54/2017', 'ministÃ©rio pÃºblico', 'atuaÃ§Ã£o resolutiva'],
      response: '**RecomendaÃ§Ã£o CNMP 54/2017** instituiu a PolÃ­tica Nacional de Fomento Ã  AtuaÃ§Ã£o Resolutiva.\n\nðŸŽ¯ **MudanÃ§a de paradigma:**\nDe uma cultura burocrÃ¡tica â†’ Para foco em RESULTADOS concretos\n\nâœ… **AtuaÃ§Ã£o resolutiva:**\nâ€¢ Prevenir/solucionar conflitos efetivamente\nâ€¢ Priorizar vias extrajudiciais\nâ€¢ Promover convergÃªncia estrutural\nâ€¢ Contribuir para desenvolvimento sustentÃ¡vel',
      links: [
        { text: 'Ver detalhes completos', path: '/metodologias' }
      ]
    },
    {
      keywords: ['como implementar', 'implementaÃ§Ã£o', 'passo a passo', 'comeÃ§ar', 'aplicar'],
      response: '**Como Implementar o DHS - Passo a Passo:**\n\n1ï¸âƒ£ **Escolher Foco PrioritÃ¡rio**\n   â€¢ ConveniÃªncia, oportunidade, urgÃªncia\n\n2ï¸âƒ£ **Mapear Necessidades e Possibilidades**\n   â€¢ DiagnÃ³stico situacional\n\n3ï¸âƒ£ **Promover ConvergÃªncia Estrutural**\n   â€¢ 13 atividades ordenadas\n   â€¢ Matriz de ConvergÃªncia\n\nExistem casos prÃ¡ticos em educaÃ§Ã£o infantil, PLANCONs e outras Ã¡reas.',
      links: [
        { text: 'Ver Guia Completo', path: '/implementacao' }
      ]
    },
    {
      keywords: ['calculadora', 'avaliar', 'medir impacto', 'anÃ¡lise'],
      response: '**Calculadora DHS** permite avaliar projetos e polÃ­ticas nos trÃªs eixos:\n\nðŸ“Š **Avalia impactos em:**\nâ€¢ Eixo Social\nâ€¢ Eixo EconÃ´mico  \nâ€¢ Eixo Ambiental\n\nGera resultado visual do equilÃ­brio e sustentabilidade.',
      links: [
        { text: 'Usar Calculadora', path: '/calculadora' }
      ]
    },
    {
      keywords: ['recursos', 'documentos', 'pdf', 'material', 'downloads'],
      response: '**Recursos e Documentos disponÃ­veis:**\n\nðŸ“„ PDFs tÃ©cnicos e guias\nðŸŒ Acordos internacionais (ODS, Agenda 2030)\nâš–ï¸ LegislaÃ§Ã£o e normativas\nðŸ”§ Ferramentas prÃ¡ticas\n\nTodo material estÃ¡ organizado por tema.',
      category: 'recursos',
      priority: 6,
      links: [
        { text: 'Acessar Recursos', path: '/recursos' }
      ]
    },
    {
      keywords: ['ods', 'objetivos desenvolvimento sustentÃ¡vel', 'agenda 2030', 'onu'],
      response: '**ODS - Objetivos de Desenvolvimento SustentÃ¡vel**\n\nðŸŒ **17 objetivos da ONU para 2030:**\n\n1. ErradicaÃ§Ã£o da pobreza\n2. Fome zero\n3. SaÃºde e bem-estar\n4. EducaÃ§Ã£o de qualidade\n5. Igualdade de gÃªnero\n6. Ãgua potÃ¡vel e saneamento\n7. Energia limpa\n8. Trabalho decente\n9. InovaÃ§Ã£o e infraestrutura\n10. ReduÃ§Ã£o das desigualdades\n11. Cidades sustentÃ¡veis\n12. Consumo responsÃ¡vel\n13. AÃ§Ã£o contra mudanÃ§a climÃ¡tica\n14. Vida na Ã¡gua\n15. Vida terrestre\n16. Paz e justiÃ§a\n17. Parcerias pelas metas\n\nâœ… O DHS alinha-se perfeitamente com os ODS, promovendo implementaÃ§Ã£o integrada.',
      category: 'conceitos',
      priority: 7,
      links: [
        { text: 'Ver Recursos', path: '/recursos' }
      ]
    },
    {
      keywords: ['tac', 'termo ajustamento conduta', 'acordo', 'compromisso'],
      response: '**TAC - Termo de Ajustamento de Conduta**\n\nðŸ“ **O que Ã©:**\nInstrumento pelo qual o responsÃ¡vel por dano ou irregularidade se compromete a regularizar a situaÃ§Ã£o.\n\nâœ… **Vantagens:**\nâ€¢ Evita judicializaÃ§Ã£o\nâ€¢ SoluÃ§Ã£o mais rÃ¡pida\nâ€¢ Economia de recursos\nâ€¢ Foco no resultado prÃ¡tico\n\nâš–ï¸ **CaracterÃ­sticas:**\nâ€¢ TÃ­tulo executivo extrajudicial\nâ€¢ ObrigaÃ§Ãµes claras e mensurÃ¡veis\nâ€¢ Prazo definido\nâ€¢ Multa por descumprimento\nâ€¢ FiscalizaÃ§Ã£o pelo MP\n\nðŸŽ¯ **AplicaÃ§Ãµes no DHS:**\nâ€¢ ExpansÃ£o de vagas em creches\nâ€¢ ImplementaÃ§Ã£o de PLANCONs\nâ€¢ AdequaÃ§Ã£o ambiental\nâ€¢ ProteÃ§Ã£o de direitos',
      category: 'instrumentos',
      priority: 6,
      links: [
        { text: 'Ver Metodologias', path: '/metodologias' }
      ]
    },
    {
      keywords: ['comdec', 'coordenadoria defesa civil', 'coordenaÃ§Ã£o municipal'],
      response: '**COMDEC - Coordenadoria Municipal de Defesa Civil**\n\nðŸ›ï¸ **O que Ã©:**\nÃ“rgÃ£o municipal responsÃ¡vel por coordenar aÃ§Ãµes de defesa civil.\n\nðŸ‘¥ **FunÃ§Ãµes:**\nâ€¢ Elaborar e atualizar PLANCON\nâ€¢ Coordenar NUPDECs\nâ€¢ Monitorar Ã¡reas de risco\nâ€¢ Acionar alertas\nâ€¢ Coordenar evacuaÃ§Ãµes\nâ€¢ Gerir abrigos emergenciais\nâ€¢ Articular resposta a desastres\n\nâš–ï¸ **ComposiÃ§Ã£o:**\nâ€¢ Representantes de diversos Ã³rgÃ£os\nâ€¢ Sociedade civil\nâ€¢ Coordenador tÃ©cnico\n\nâœ… Essencial para gestÃ£o de riscos e desastres.',
      category: 'plancon',
      priority: 7,
      links: [
        { text: 'Ver PLANCON', path: '/plano-contingencia' }
      ]
    },
    {
      keywords: ['ajuda', 'help', 'nÃ£o entendi', 'dÃºvida', 'como funciona', 'me ajude', 'preciso ajuda', 'temas', 'assuntos'],
      response: 'Posso ajudar vocÃª com informaÃ§Ãµes sobre:\n\nðŸ“š **Conceitos:** DHS, ConvergÃªncia Estrutural, PGS, Pensamento SistÃªmico\nðŸ› ï¸ **ImplementaÃ§Ã£o:** Passo a passo, casos prÃ¡ticos, Matriz de ConvergÃªncia\nðŸ“‹ **Temas especÃ­ficos:** EducaÃ§Ã£o Infantil, Planos de ContingÃªncia, ViolÃªncia ECA, Crime Organizado\nâš–ï¸ **Instrumentos jurÃ­dicos:** RecomendaÃ§Ãµes CNMP, TACs, ResoluÃ§Ãµes\nðŸŒ **Meio Ambiente:** Desastres naturais, mudanÃ§as climÃ¡ticas\nðŸš¸ **ProteÃ§Ã£o:** CrianÃ§as, adolescentes, primeira infÃ¢ncia\n\nðŸ’¬ **Dicas de uso:**\nâ€¢ FaÃ§a perguntas diretas e especÃ­ficas\nâ€¢ Use palavras-chave do tema de interesse\nâ€¢ Clique nas sugestÃµes de perguntas\nâ€¢ Explore os links para mais detalhes',
      category: 'ajuda',
      priority: 8,
      suggestions: [
        'O que Ã© DHS?',
        'Como fazer PLANCON?',
        'EducaÃ§Ã£o Infantil',
        'Metodologias'
      ]
    },
    {
      keywords: ['obrigado', 'obrigada', 'valeu', 'agradeÃ§o', 'muito obrigado', 'thanks', 'grato'],
      response: 'Por nada! ðŸ˜Š Fico feliz em ajudar!\n\nSe tiver mais alguma dÃºvida sobre o DHS ou qualquer tema do site, estou Ã  disposiÃ§Ã£o.\n\nðŸ’¡ VocÃª tambÃ©m pode:\nâ€¢ Explorar as pÃ¡ginas pelo menu superior\nâ€¢ Usar a ferramenta de busca (ðŸ”)\nâ€¢ Usar a Calculadora DHS\nâ€¢ Baixar documentos em PDF',
      category: 'cortesia',
      priority: 5,
      suggestions: [
        'Quero saber mais sobre outro tema',
        'Como navegar no site?'
      ]
    },
    {
      keywords: ['tchau', 'atÃ© logo', 'bye', 'atÃ© mais', 'adeus', 'vou sair', 'fim'],
      response: 'AtÃ© logo! ðŸ‘‹\n\nEspero ter ajudado vocÃª a entender melhor o Desenvolvimento HarmÃ´nico e SustentÃ¡vel.\n\nVolte sempre que precisar! O chat salva nosso histÃ³rico por 24h para continuarmos de onde paramos.\n\nðŸŒ± Juntos podemos construir um futuro mais sustentÃ¡vel!',
      category: 'despedida',
      priority: 5
    },
    {
      keywords: ['matriz convergÃªncia', 'matriz', 'guia implementaÃ§Ã£o', 'ferramenta prÃ¡tica'],
      response: '**Matriz de ConvergÃªncia DHS** Ã© uma ferramenta prÃ¡tica para implementaÃ§Ã£o estruturada.\n\nðŸ“Š **Estrutura:**\nâ€¢ 13 atividades ordenadas\nâ€¢ Cada atividade com passos claros\nâ€¢ ResponsÃ¡veis e prazos\nâ€¢ Indicadores de progresso\n\nðŸŽ¯ **AplicaÃ§Ã£o:**\nPode ser usada em diversos contextos (educaÃ§Ã£o infantil, defesa civil, saÃºde, etc.)\n\nðŸ“¥ DisponÃ­vel em PDF detalhado para download.',
      category: 'implementaÃ§Ã£o',
      priority: 8,
      links: [
        { text: 'Ver Guia de ImplementaÃ§Ã£o', path: '/implementacao' }
      ],
      relatedQuestions: ['Quais sÃ£o as 13 atividades?', 'Como usar a matriz?']
    },
    {
      keywords: ['pensamento sistÃªmico', 'sistemico', 'visÃ£o holÃ­stica', 'complexidade', 'interconexÃµes'],
      response: '**Pensamento SistÃªmico** Ã© a base do DHS - olhar para o TODO e as INTERCONEXÃ•ES.\n\nðŸ”„ **PrincÃ­pios:**\nâ€¢ Tudo estÃ¡ interconectado\nâ€¢ AÃ§Ãµes geram efeitos em cascata\nâ€¢ Foco nas relaÃ§Ãµes, nÃ£o sÃ³ nos elementos\nâ€¢ Identificar padrÃµes e feedbacks\n\nâš ï¸ **Problema atual:**\nAbordagens fragmentadas tratam sintomas, nÃ£o causas raÃ­zes.\n\nâœ… **SoluÃ§Ã£o DHS:**\nVisÃ£o integrada que aborda problemas de forma estrutural.',
      category: 'conceitos',
      priority: 8,
      links: [
        { text: 'Entender o DiagnÃ³stico', path: '/diagnostico' },
        { text: 'Ver SoluÃ§Ãµes', path: '/solucoes' }
      ]
    },
    {
      keywords: ['pgs', 'planejamento gestÃ£o sistÃªmicos', 'planejamento sistemico'],
      response: '**PGS** (Planejamento e GestÃ£o SistÃªmicos) Ã© uma metodologia estruturada.\n\nðŸ“‹ **Etapas:**\n1ï¸âƒ£ DiagnÃ³stico sistÃªmico\n2ï¸âƒ£ DefiniÃ§Ã£o de objetivos integrados\n3ï¸âƒ£ Mapeamento de atores e recursos\n4ï¸âƒ£ Planejamento coordenado\n5ï¸âƒ£ ImplementaÃ§Ã£o convergente\n6ï¸âƒ£ Monitoramento e avaliaÃ§Ã£o\n\nðŸŽ¯ Diferencial: Considera interconexÃµes e promove alinhamento entre todos os envolvidos.',
      category: 'metodologias',
      priority: 8,
      links: [
        { text: 'Ver Metodologias', path: '/metodologias' }
      ]
    },
    {
      keywords: ['nmc', 'comunicaÃ§Ã£o nÃ£o violenta', 'comunicacao nao violenta', 'cnv'],
      response: '**NMC** (ComunicaÃ§Ã£o NÃ£o-Violenta) Ã© fundamental para promover convergÃªncia.\n\nðŸ’¬ **4 Componentes:**\n1ï¸âƒ£ **ObservaÃ§Ã£o** - fatos sem julgamento\n2ï¸âƒ£ **Sentimento** - expressÃ£o emocional\n3ï¸âƒ£ **Necessidade** - valores subjacentes\n4ï¸âƒ£ **Pedido** - aÃ§Ã£o concreta\n\nâœ… **BenefÃ­cios:**\nâ€¢ Reduz conflitos\nâ€¢ Facilita diÃ¡logo\nâ€¢ Promove empatia\nâ€¢ Aumenta efetividade das negociaÃ§Ãµes',
      category: 'metodologias',
  const findBestResponse = (userInput: string): KnowledgeBase | null => {
    const input = userInput.toLowerCase().trim()
    
    // Buscar correspondÃªncia exata ou parcial com contexto
    let bestMatch: KnowledgeBase | null = null
    let maxScore = 0

    knowledgeBase.forEach(kb => {
      let score = 0
      
      // PontuaÃ§Ã£o base por palavra-chave encontrada
      kb.keywords.forEach(keyword => {
        if (input.includes(keyword)) {
          score += keyword.length * 2 // Palavras mais longas tÃªm mais peso
          
          // Bonus se for correspondÃªncia exata
          if (input === keyword) {
            score += 10
          }
          
          // Bonus se a palavra-chave estiver no inÃ­cio
          if (input.startsWith(keyword)) {
            score += 5
          }
  const handleSendMessage = () => {
    if (!inputValue.trim()) return

    const userText = inputValue.trim()
    addUserMessage(userText)
    setInputValue('')
    setIsTyping(true)
    setShowSuggestions(false)

    // Simular digitaÃ§Ã£o do bot com tempo variÃ¡vel baseado no tamanho da resposta
    const typingDelay = Math.min(userText.length * 50 + 800, 2000)
    
    setTimeout(() => {
      const response = findBestResponse(userText)
      
      if (response) {
        // Adicionar categoria ao contexto
        if (response.category) {
          setConversationContext(prev => [...prev, response.category!].slice(-3))
        }
        
        let fullResponse = response.response

        if (response.links && response.links.length > 0) {
          fullResponse += '\n\nðŸ”— **Links Ãºteis:**'
          // Links serÃ£o renderizados separadamente
        }

        addBotMessage(fullResponse, response.relatedQuestions)
        
        // Adicionar links como mensagem separada se houver
        if (response.links && response.links.length > 0) {
          setTimeout(() => {
            const linksMessage: Message = {
              id: (Date.now() + 1).toString(),
              text: 'links',
              sender: 'bot',
              timestamp: new Date()
            }
            setMessages(prev => [...prev, linksMessage])
          }, 500)
        }
      } else {
        // Resposta mais inteligente quando nÃ£o encontra correspondÃªncia
        const suggestions = [
          'O que Ã© DHS?',
          'Como implementar?',
          'Plano de ContingÃªncia',
          'Primeira InfÃ¢ncia'
        ]
        
        // Tentar sugerir baseado em palavras da pergunta
        if (userText.match(/educa|creche|crianÃ§a|escola|infÃ¢ncia/i)) {
          suggestions[3] = 'EducaÃ§Ã£o Infantil'
          suggestions[1] = 'O que Ã© DONQEEI?'
        } else if (userText.match(/desastre|emergÃªncia|risco|alerta/i)) {
          suggestions[2] = 'O que sÃ£o NUPDECs?'
          suggestions[3] = 'Como fazer PLANCON?'
        } else if (userText.match(/crime|trÃ¡fico|violÃªncia|seguranÃ§a/i)) {
          suggestions[2] = 'Crime Organizado'
          suggestions[3] = 'ViolÃªncia contra crianÃ§as'
        }
        
        addBotMessage(
          'Desculpe, nÃ£o encontrei uma resposta especÃ­fica para sua pergunta. ðŸ¤”\n\nðŸ’¡ **Tente:**\nâ€¢ Reformular com palavras-chave diferentes\nâ€¢ Ser mais especÃ­fico\nâ€¢ Escolher um tema abaixo\nâ€¢ Usar a busca (ðŸ”) no topo da pÃ¡gina\n\nðŸ“š Principais temas: DHS, PLANCON, EducaÃ§Ã£o Infantil, ECA, Crime Organizado, Metodologias, ImplementaÃ§Ã£o',
          suggestions
        )
      }
      
      setIsTyping(false)
      setShowSuggestions(true)
    }, typingDelay)
  }   timestamp: new Date().toISOString()
    }
    
    const savedFeedback = localStorage.getItem('dhs-chat-feedback') || '[]'
    const feedbackArray = JSON.parse(savedFeedback)
    feedbackArray.push(feedbackData)
    localStorage.setItem('dhs-chat-feedback', JSON.stringify(feedbackArray))
  }

  const copyMessage = (messageId: string, text: string) => {
    navigator.clipboard.writeText(text)
    setMessages(prev => prev.map(msg => 
      msg.id === messageId ? { ...msg, copied: true } : msg
    ))
    
    setTimeout(() => {
      setMessages(prev => prev.map(msg => 
        msg.id === messageId ? { ...msg, copied: false } : msg
      ))
    }, 2000)
  }     addBotMessage(
          'OlÃ¡! ðŸ‘‹ Sou o assistente virtual do DHS Guide.\n\nEstou aqui para ajudÃ¡-lo a entender o Desenvolvimento HarmÃ´nico e SustentÃ¡vel e todos os temas do site.\n\nComo posso ajudar vocÃª hoje?',
          [
            'O que Ã© DHS?',
            'Como implementar?',
            'Plano de ContingÃªncia',
            'Primeira InfÃ¢ncia'
          ]
        )
      }, 500)
    }
  }, [isOpen])

  const addBotMessage = (text: string, suggestions?: string[]) => {
    const botMessage: Message = {
      id: Date.now().toString(),
      text,
      sender: 'bot',
      timestamp: new Date(),
      suggestions
    }
    setMessages(prev => [...prev, botMessage])
  }

  const addUserMessage = (text: string) => {
    const userMessage: Message = {
      id: Date.now().toString(),
      text,
      sender: 'user',
      timestamp: new Date()
    }
    setMessages(prev => [...prev, userMessage])
  }

  const findBestResponse = (userInput: string): KnowledgeBase | null => {
    const input = userInput.toLowerCase().trim()
    
    // Normalizar texto removendo acentos para melhor busca
    const normalizeText = (text: string) => {
      return text
        .normalize('NFD')
        .replace(/[\u0300-\u036f]/g, '')
        .toLowerCase()
    }
    
    const normalizedInput = normalizeText(input)
    
    // Buscar correspondÃªncia exata ou parcial com contexto
    let bestMatch: KnowledgeBase | null = null
    let maxScore = 0

    knowledgeBase.forEach(kb => {
      let score = 0
      
      // PontuaÃ§Ã£o base por palavra-chave encontrada
      kb.keywords.forEach(keyword => {
        const normalizedKeyword = normalizeText(keyword)
        
        // CorrespondÃªncia exata
        if (input.includes(keyword) || normalizedInput.includes(normalizedKeyword)) {
          score += keyword.length * 3 // Palavras mais longas tÃªm mais peso
          
          // Bonus se for correspondÃªncia exata completa
          if (input === keyword || normalizedInput === normalizedKeyword) {
            score += 20
          }
          
          // Bonus se a palavra-chave estiver no inÃ­cio
          if (input.startsWith(keyword) || normalizedInput.startsWith(normalizedKeyword)) {
            score += 10
          }
          
          // Bonus para frases mÃºltiplas (passos, como fazer, etc)
          if (keyword.split(' ').length > 2) {
            score += 5
          }
        }
        
        // Busca por palavras individuais da keyword
        const keywordWords = normalizedKeyword.split(' ')
        const inputWords = normalizedInput.split(' ')
        let matchedWords = 0
        
        keywordWords.forEach(kw => {
          if (kw.length > 3 && inputWords.some(iw => iw.includes(kw) || kw.includes(iw))) {
            matchedWords++
          }
        })
        
        // Bonus se mÃºltiplas palavras da keyword correspondem
        if (matchedWords > 1) {
          score += matchedWords * 2
        }
      })
      
      // Verificar sinÃ´nimos para melhorar a detecÃ§Ã£o
      if (kb.synonyms) {
        kb.synonyms.forEach(synonym => {
          const normalizedSynonym = normalizeText(synonym)
          if (normalizedInput.includes(normalizedSynonym)) {
            score += 3
          }
        })
      }
      
      // Bonus por prioridade da base de conhecimento
      if (kb.priority) {
        score += kb.priority
      }
      
      // Bonus por contexto da conversa
      if (conversationContext.length > 0) {
        const lastContext = conversationContext[conversationContext.length - 1]
        if (kb.category === lastContext) {
          score += 5
        }
      }
      
      if (score > maxScore) {
        maxScore = score
        bestMatch = kb
      }
    })

    return maxScore > 0 ? bestMatch : null
  }

  const handleSendMessage = () => {
    if (!inputValue.trim()) return

    const userText = inputValue.trim()
    addUserMessage(userText)
    setInputValue('')
    setIsTyping(true)

    // Simular digitaÃ§Ã£o do bot
    setTimeout(() => {
      const response = findBestResponse(userText)
      
  return (
    <>
      {/* BotÃ£o flutuante */}
      {!isOpen && (
        <button
          onClick={() => setIsOpen(true)}
          className="fixed bottom-6 right-6 bg-gradient-to-r from-primary-600 to-primary-700 text-white p-4 rounded-full shadow-lg hover:shadow-xl hover:from-primary-700 hover:to-primary-800 transition-all hover:scale-110 z-50 group animate-bounce"
          style={{ animationDuration: '3s' }}
          title="Abrir assistente DHS"
        >
          <MessageCircle className="w-6 h-6" />
          {unreadCount > 0 && (
            <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center font-bold shadow-md">
              {unreadCount}
            </span>
          )}
          <Sparkles className="absolute -top-1 -left-1 w-4 h-4 text-yellow-300 animate-pulse" />
          <div className="absolute bottom-full right-0 mb-2 px-3 py-2 bg-gray-900 text-white text-xs rounded-lg whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity shadow-xl">
            ðŸ’¬ Precisa de ajuda? Clique aqui!
            <div className="absolute top-full right-4 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-gray-900"></div>
          </div>
        </button>
      )}      timestamp: new Date()
            {/* Header */}
            <div className="bg-gradient-to-r from-primary-600 to-primary-700 text-white p-4 rounded-t-lg flex items-center justify-between shadow-md">
              <div className="flex items-center gap-3">
                <div className="bg-white p-2 rounded-full relative">
                  <Bot className="w-5 h-5 text-primary-600" />
                  <div className="absolute -bottom-1 -right-1 w-3 h-3 bg-green-500 rounded-full border-2 border-white"></div>
                </div>
                <div>
                  <h3 className="font-semibold flex items-center gap-2">
                    Assistente DHS
                    <Sparkles className="w-4 h-4 text-yellow-300" />
                  </h3>
                  <p className="text-xs text-primary-100">ðŸŸ¢ Online â€¢ Sempre disponÃ­vel</p>
                </div>
              </div>
              <div className="flex items-center gap-1">
                {messages.length > 1 && (
                  <button
                    onClick={clearChat}
                    className="p-1.5 hover:bg-primary-500 rounded transition-colors"
                    title="Limpar conversa"
                  >
                    <Trash2 className="w-4 h-4" />
                  </button>
                )}
                <button
                  onClick={() => setIsMinimized(!isMinimized)}
                  className="p-1.5 hover:bg-primary-500 rounded transition-colors"
                  title={isMinimized ? "Expandir" : "Minimizar"}
                >
                  {isMinimized ? <Maximize2 className="w-4 h-4" /> : <Minimize2 className="w-4 h-4" />}
                </button>
                <button
                  onClick={() => setIsOpen(false)}
                  className="p-1.5 hover:bg-primary-500 rounded transition-colors"
                  title="Fechar"
                >
                  <X className="w-5 h-5" />
                </button>
              </div>
            </div>e)
  }

  const formatMessage = (text: string) => {
    // Formatar markdown bÃ¡sico
    const lines = text.split('\n')
    return lines.map((line, i) => {
      // Negrito
      line = line.replace(/\*\*(.+?)\*\*/g, '<strong>$1</strong>')
      // ItÃ¡lico
      line = line.replace(/\*(.+?)\*/g, '<em>$1</em>')
      
      return <div key={i} dangerouslySetInnerHTML={{ __html: line }} />
    })
  }

  const renderMessageContent = (message: Message) => {
    if (message.text === 'links' && message.sender === 'bot') {
      // Buscar links da Ãºltima resposta
      const lastUserMessage = [...messages].reverse().find(m => m.sender === 'user')
      if (lastUserMessage) {
        const response = findBestResponse(lastUserMessage.text)
        if (response?.links) {
          return (
            <div className="flex flex-col gap-2">
              {response.links.map((link, idx) => (
                <button
                  key={idx}
                  onClick={() => handleLinkClick(link.path)}
                  className="text-left px-3 py-2 bg-primary-50 text-primary-700 rounded hover:bg-primary-100 transition-colors text-sm flex items-center gap-2"
                >
                  <span>â†’</span>
                  <span>{link.text}</span>
                </button>
              ))}
            </div>
          )
        }
      }
      return null
    }

    return (
      <div className="whitespace-pre-wrap text-sm">
        {formatMessage(message.text)}
      </div>
    )
  }

  return (
    <>
      {/* BotÃ£o flutuante */}
      {!isOpen && (
        <button
          onClick={() => setIsOpen(true)}
          className="fixed bottom-6 right-6 bg-primary-600 text-white p-4 rounded-full shadow-lg hover:bg-primary-700 transition-all hover:scale-110 z-50 group"
          title="Abrir chat"
        >
          <MessageCircle className="w-6 h-6" />
          <span className="absolute -top-1 -right-1 bg-red-500 text-white text-xs rounded-full w-5 h-5 flex items-center justify-center animate-pulse">
            !
          </span>
          <div className="absolute bottom-full right-0 mb-2 px-3 py-1 bg-gray-900 text-white text-xs rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity">
            Precisa de ajuda? Clique aqui!
          </div>
        </button>
      )}

      {/* Janela do chat */}
      {isOpen && (
        <div className={`fixed ${isMinimized ? 'bottom-6 right-6' : 'bottom-6 right-6'} z-50 transition-all ${isMinimized ? 'w-80' : 'w-96'}`}>
          <div className={`bg-white rounded-lg shadow-2xl flex flex-col ${isMinimized ? 'h-14' : 'h-[600px]'} transition-all`}>
            {/* Header */}
            <div className="bg-gradient-to-r from-primary-600 to-primary-700 text-white p-4 rounded-t-lg flex items-center justify-between">
              <div className="flex items-center gap-3">
                <div className="bg-white p-2 rounded-full">
                  <Bot className="w-5 h-5 text-primary-600" />
                </div>
                <div>
                  <h3 className="font-semibold">Assistente DHS</h3>
                        {/* Message bubble */}
                        <div className="flex-1">
                          <div className={`rounded-lg p-3 ${
                            message.sender === 'user'
                              ? 'bg-gradient-to-r from-primary-600 to-primary-700 text-white shadow-md'
                              : 'bg-white text-gray-800 shadow-sm border border-gray-200'
                          }`}>
                            {renderMessageContent(message)}
                          </div>

                          {/* Bot message actions */}
                          {message.sender === 'bot' && message.text !== 'links' && (
                            <div className="mt-1 flex items-center gap-2 text-xs">
                              <button
                                onClick={() => copyMessage(message.id, message.text)}
                                className="flex items-center gap-1 text-gray-500 hover:text-primary-600 transition-colors"
                                title="Copiar mensagem"
                              >
                                <Copy className="w-3 h-3" />
                                {message.copied ? (
                                  <span className="text-green-600">Copiado!</span>
                                ) : (
                                  <span>Copiar</span>
                                )}
                              </button>
                              <span className="text-gray-300">â€¢</span>
                              <button
                                onClick={() => handleFeedback(message.id, 'positive')}
                                className={`flex items-center gap-1 transition-colors ${
                                  message.feedback === 'positive'
                                    ? 'text-green-600'
                                    : 'text-gray-500 hover:text-green-600'
                                }`}
                                title="Resposta Ãºtil"
                              >
                                <ThumbsUp className="w-3 h-3" />
                              </button>
                              <button
                                onClick={() => handleFeedback(message.id, 'negative')}
                                className={`flex items-center gap-1 transition-colors ${
                                  message.feedback === 'negative'
                                    ? 'text-red-600'
                                    : 'text-gray-500 hover:text-red-600'
                                }`}
                                title="Resposta nÃ£o Ãºtil"
                              >
                                <ThumbsDown className="w-3 h-3" />
                              </button>
                            </div>
                          )}
                {/* Quick suggestions antes do input */}
                {messages.length === 0 && (
                  <div className="px-4 py-2 bg-gradient-to-r from-primary-50 to-blue-50 border-t border-gray-200">
                    <p className="text-xs font-semibold text-gray-700 mb-2">ðŸ’¡ Perguntas frequentes:</p>
                    <div className="flex flex-wrap gap-1.5">
                      {['O que Ã© DHS?', 'PLANCON', 'EducaÃ§Ã£o Infantil', 'Como implementar?'].map((q, i) => (
                        <button
                          key={i}
                          onClick={() => handleSuggestionClick(q)}
                          className="text-xs px-2 py-1 bg-white text-primary-700 rounded-md hover:bg-primary-100 transition-colors border border-primary-200 shadow-sm"
                        >
                          {q}
                        </button>
                      ))}
                    </div>
                  </div>
                )}

                {/* Input */}
                <div className="p-4 border-t border-gray-200 bg-gradient-to-r from-gray-50 to-white rounded-b-lg">
                  <div className="flex gap-2">
                    <input
                      ref={inputRef}
                      type="text"
                      value={inputValue}
                      onChange={(e) => setInputValue(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && !e.shiftKey && handleSendMessage()}
                      placeholder="Digite sua pergunta sobre DHS..."
                      className="flex-1 px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm shadow-sm"
                    />
                    <button
                      onClick={handleSendMessage}
                      disabled={!inputValue.trim() || isTyping}
                      className="bg-gradient-to-r from-primary-600 to-primary-700 text-white p-2.5 rounded-lg hover:from-primary-700 hover:to-primary-800 transition-all disabled:from-gray-300 disabled:to-gray-400 disabled:cursor-not-allowed shadow-md hover:shadow-lg disabled:shadow-none"
                      title="Enviar mensagem"
                    >
                      <Send className="w-5 h-5" />
                    </button>
                  </div>
                  <div className="flex items-center justify-between mt-2">
                    <p className="text-xs text-gray-500">
                      âŽ Enter para enviar
                    </p>
                    {messages.length > 0 && (
                      <p className="text-xs text-gray-400">
                        ðŸ’¾ HistÃ³rico salvo por 24h
                      </p>
                    )}
                  </div>
                </div>iv
                      key={message.id}
                      className={`flex ${message.sender === 'user' ? 'justify-end' : 'justify-start'}`}
                    >
                      <div className={`flex gap-2 max-w-[85%] ${message.sender === 'user' ? 'flex-row-reverse' : 'flex-row'}`}>
                        {/* Avatar */}
                        <div className={`flex-shrink-0 w-8 h-8 rounded-full flex items-center justify-center ${
                          message.sender === 'user' ? 'bg-primary-600' : 'bg-gray-300'
                        }`}>
                          {message.sender === 'user' ? (
                            <User className="w-5 h-5 text-white" />
                          ) : (
                            <Bot className="w-5 h-5 text-gray-700" />
                          )}
                        </div>

                        {/* Message bubble */}
                        <div>
                          <div className={`rounded-lg p-3 ${
                            message.sender === 'user'
                              ? 'bg-primary-600 text-white'
                              : 'bg-white text-gray-800 shadow-sm border border-gray-200'
                          }`}>
                            {renderMessageContent(message)}
                          </div>

                          {/* Suggestions */}
                          {message.suggestions && message.suggestions.length > 0 && (
                            <div className="mt-2 flex flex-wrap gap-2">
                              {message.suggestions.map((suggestion, idx) => (
                                <button
                                  key={idx}
                                  onClick={() => handleSuggestionClick(suggestion)}
                                  className="text-xs px-3 py-1 bg-gray-100 text-gray-700 rounded-full hover:bg-primary-100 hover:text-primary-700 transition-colors border border-gray-300"
                                >
                                  {suggestion}
                                </button>
                              ))}
                            </div>
                          )}
                        </div>
                      </div>
                    </div>
                  ))}

                  {/* Typing indicator */}
                  {isTyping && (
                    <div className="flex justify-start">
                      <div className="flex gap-2">
                        <div className="w-8 h-8 rounded-full bg-gray-300 flex items-center justify-center">
                          <Bot className="w-5 h-5 text-gray-700" />
                        </div>
                        <div className="bg-white rounded-lg p-3 shadow-sm border border-gray-200">
                          <div className="flex gap-1">
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '0ms' }}></div>
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '150ms' }}></div>
                            <div className="w-2 h-2 bg-gray-400 rounded-full animate-bounce" style={{ animationDelay: '300ms' }}></div>
                          </div>
                        </div>
                      </div>
                    </div>
                  )}

                  <div ref={messagesEndRef} />
                </div>

                {/* Input */}
                <div className="p-4 border-t border-gray-200 bg-white rounded-b-lg">
                  <div className="flex gap-2">
                    <input
                      type="text"
                      value={inputValue}
                      onChange={(e) => setInputValue(e.target.value)}
                      onKeyPress={(e) => e.key === 'Enter' && handleSendMessage()}
                      placeholder="Digite sua pergunta..."
                      className="flex-1 px-4 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-500 text-sm"
                    />
                    <button
                      onClick={handleSendMessage}
                      disabled={!inputValue.trim()}
                      className="bg-primary-600 text-white p-2 rounded-lg hover:bg-primary-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
                    >
                      <Send className="w-5 h-5" />
                    </button>
                  </div>
                  <p className="text-xs text-gray-500 mt-2 text-center">
                    Pressione Enter para enviar
                  </p>
                </div>
              </>
            )}
          </div>
        </div>
      )}
    </>
  )
}
